
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

    <title>Test</title>
    <meta name="description" content="Realización de test para nuestro proyecto.">
    <meta name="author" content="Evenge">

    <!-- Enable responsive viewport -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Bootstrap styles -->
    <link href="/assets/themes/bootstrap-3/bootstrap/css/bootstrap.min.css" rel="stylesheet">
    <!-- Optional theme -->
    <link href="/assets/themes/bootstrap-3/bootstrap/css/bootstrap-theme.min.css" rel="stylesheet">
    <!-- Sticky Footer -->
    <link href="/assets/themes/bootstrap-3/bootstrap/css/bs-sticky-footer.css" rel="stylesheet">

    <!-- Custom styles -->
    <link href="/assets/themes/bootstrap-3/css/style.css?body=1" rel="stylesheet" type="text/css" media="all">

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
      <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
    <![endif]-->

    <!-- Fav and touch icons -->
    <!-- Update these with your own images
      <link rel="shortcut icon" href="images/favicon.ico">
      <link rel="apple-touch-icon" href="images/apple-touch-icon.png">
      <link rel="apple-touch-icon" sizes="72x72" href="images/apple-touch-icon-72x72.png">
      <link rel="apple-touch-icon" sizes="114x114" href="images/apple-touch-icon-114x114.png">
    -->

    <!-- atom & rss feed -->
    <link href="/atom.xml" type="application/atom+xml" rel="alternate" title="Sitewide ATOM Feed">
    <link href="/rss.xml" type="application/rss+xml" rel="alternate" title="Sitewide RSS Feed">

  </head>

  <body>
    <div id="wrap">
      <nav class="navbar navbar-default" role="navigation">
        <!-- Brand and toggle get grouped for better mobile display -->
        <div class="navbar-header">
          <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#jb-navbar-collapse">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="/">EVENGE</a>
        </div>

        <!-- Collect the nav links, forms, and other content for toggling -->
        <div class="collapse navbar-collapse" id="jb-navbar-collapse">
          <ul class="nav navbar-nav">
            
            
            


  
    
      
    
  
    
      
    
  
    
      
      	
      	<li><a href="/blog.html">Blog</a></li>
      	
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  



          </ul>
          <!--<form class="navbar-form navbar-right" role="search">
            <div class="form-group">
              <input type="text" class="form-control" placeholder="Search">
            </div>
            <button type="submit" class="btn btn-default">Submit</button>
          </form> -->
        </div><!-- /.navbar-collapse -->
      </nav>

      <div class="container">
        
<div class="page-header">
  <h1>Test </h1>
</div>

<div class="row post-full">
  <div class="col-xs-12">
    <div class="date">
      <span>16 December 2014</span>
    </div>
    <div class="content">
      
<p>Tras mucha investigación de como hacer los test unitarios sobre nuestra aplicación en GAE, hemos conseguido realizarlos con éxito.  </p>

<p>Para ello hemos tenido que usar bastante información buscada por Internet, por lo que hemos tomado como referencia:  </p>

<ul>
  <li><a href="https://cloud.google.com/appengine/docs/python/tools/localunittesting">Local Unit Testing for Python</a>  </li>
  <li><a href="https://cloud.google.com/appengine/docs/python/tools/handlertesting">Handler Testing For Python</a>  </li>
  <li><a href="http://docs.shippable.com/en/latest/">API Shippable</a>  </li>
  <li><a href="http://stackoverflow.com/questions/9511887/webtest-for-google-app-engine">Stackoverflow</a>  </li>
</ul>

<p>Nuestro test sirve para comprobar que nuestra apliacación se despliega correctamente y en caso de que sea así haga un “Deploy” de esta a GAE.</p>

<p>Para poder realizar este test, es necesario la configuración de 3 archivos que se deben de incorporar al repositorio del proyecto. Son los siguientes:</p>

<ul>
  <li>
    <p><a href="https://github.com/evenge/EVENGE/blob/master/requirements.txt">requeriments.txt</a></p>

    <pre><code>nose  
coverage  
NoseGAE  
WebTest  
</code></pre>
  </li>
  <li>
    <p><a href="https://github.com/evenge/EVENGE/blob/master/test.py">test.py</a></p>

    <pre><code>import unittest
from google.appengine.ext import db
from google.appengine.ext import testbed
from index import Evenge

class EvengeTestCase(unittest.TestCase):
def setUp(self):
self.testbed = testbed.Testbed()
self.testbed.activate()
self.testbed.init_datastore_v3_stub()

def tearDown(self):
self.testbed.deactivate()

def test(self):
evenge = Evenge()
response = evenge.hazElCuadrado(4)
self.assertEqual(response,16)

if __name__ == "__main__":
unittest.main()
</code></pre>
  </li>
  <li>
    <p><a href="https://github.com/evenge/EVENGE/blob/master/shippable.yml">shippable.yaml</a></p>

    <pre><code>language: python

python:
- "2.7"

#Esto es para desplegar en App Engine
env:
global:
- GAE_DIR=/tmp/gae
- EMAIL=8macau8@gmail.com
- secure: RACsb1T9/QPr32TxNHaQ5yqq/EyWXSFIKlmmh633cvxygeBt7UJoM674Pqkg2RfwHN4XJ+lrC8s4FDffixbK4OXKr7aW0lNjLNcdPM/1NgZC1mimNGG+UOB1sAMkLUO909V+pMHq53f5oYb+s3aHFukq9zG5+d7+yNZ89bb+lX4ujhFjxMTltT8OOuQvzFwRkOoTH7CdfJDUqeF+MABCuzOFq1ewU6j0QqTi4DtZP4ZNNMA/8b0935U2tOdFlbQ8Xx1ZTm6UFrMGEJGlfRJAOKls20mXiF3wudYSXEw69PztNyJ2vg+WL7oE6xUobJHXOLIReevDm7KrmEC8p7Re4w==

#Instalarse la mágina virtual GAE
before_install:
- &gt;
test -e $GAE_DIR ||
(mkdir -p $GAE_DIR &amp;&amp;
wget https://storage.googleapis.com/appengine-sdks/featured/google_appengine_1.9.15.zip -q -O /tmp/gae.zip &amp;&amp;
unzip /tmp/gae.zip -d $GAE_DIR)
#Instalar requerimientos
install:
- pip install -r requirements.txt

before_script:
- echo 'Europe/Madrid' | sudo tee /etc/timezone
- sudo dpkg-reconfigure --frontend noninteractive tzdata
- mkdir -p shippable/testresults
- mkdir -p shippable/codecoverage

#Ejecutamos el script
script:
- &gt;
nosetests test.py
--with-gae --without-sandbox --gae-lib-root=$GAE_DIR/google_appengine
--with-xunit --xunit-file=shippable/testresults/test.xml
--with-coverage --cover-xml --cover-xml-file=shippable/codecoverage/coverage.xml
#Si se construye bien hacer esto
after_success:
- $GAE_DIR/google_appengine/appcfg.py --oauth2_access_token=$GAE_TOKEN update .
</code></pre>
  </li>
</ul>

<p>El archivo más importante es “Shippable” que es el que se encarga de realizar el test
  con la ejecución del script:</p>

<pre><code>#Ejecutamos el script
script:
- &gt;
nosetests test.py
--with-gae --without-sandbox --gae-lib-root=$GAE_DIR/google_appengine --with-xunit --xunit-file=shippable/testresults/test.xml --with-coverage --cover-xml --cover-xml-file=shippable/codecoverage/coverage.xml
</code></pre>

<p>Cada archivo viene comentado con todo lo que hace.</p>

<p>Estos test pueden ser usados por cualquiera, solo que deben de ser modificados para su correcto funcionamiento en su correspondiente aplicación.</p>

<p>#Ejecutar el test#</p>

<p>Antes de proceder a ejecutar el test debemos de estar logueados en <a href="http://www.shippable.com/">Shippable</a> y haber autorizado a “Shippable” entrar en nuestro repositorio de “GitHub”.
  <img src="http://i58.tinypic.com/2ros6ix.png" alt="TEST" /></p>

<p>Una vez dentro de “Shippable”, nos encontramos con este panel, que nos muestra información del test:</p>

<p><img src="http://i61.tinypic.com/saxj0w.png" alt="TEST" /></p>

<p>Una vez realizado esto procedemos con con la ejecucion del test:</p>

<p>Lo primero que debemos de hacer es un “push” al repositorio y seguidamente hacer un “commit”, entonces al realizar el “commit” es cuando se ejecuta el test, que lo ejecuta “shippable” ejecutando el script. Cuando termina de realizar el test nos muestra este log:
  <img src="http://i58.tinypic.com/vwtp2x.png" alt="TEST" />
  Este log nos muestra el resultado del test, si ha habido algun error o fallo, asi como si esta todo bien, en esta caso esta bien y nos da “Passing”.</p>

<p>En caso de que todo haya salido bien y nos encontremos en la rama master, se realiza un “Deploy” a GAE.</p>

<pre><code>after_success:
- if [ "$BRANCH" == "master" ]; then $GAE_DIR/google_appengine/appcfg.py --oauth2_refresh_token=$GAE_TOKEN update . ; else echo "No deployment for this $BRANCH"; fi
</code></pre>

<p><a href="https://evenge-2014.appspot.com/">Aplicación</a></p>

    </div>

  
    <ul class="tag_box inline">
      <li><i class="glyphicon glyphicon-open"></i></li>
      
      


  
     
    	<li><a href="/categories.html#test-ref">
    		test <span>2</span>
    	</a></li>
    
  


    </ul>
  

  
    <ul class="tag_box inline">
      <li><i class="glyphicon glyphicon-tags"></i></li>
      
      


  
     
    	<li><a href="/tags.html#test-ref">test <span>1</span></a></li>
     
    	<li><a href="/tags.html#GAE-ref">GAE <span>2</span></a></li>
     
    	<li><a href="/tags.html#Google App Engine-ref">Google App Engine <span>2</span></a></li>
     
    	<li><a href="/tags.html#Evenge-ref">Evenge <span>4</span></a></li>
     
    	<li><a href="/tags.html#Gestor documental-ref">Gestor documental <span>1</span></a></li>
    
  



    </ul>
  

    <hr>
    <ul class="pagination">
    
      <li class="prev"><a href="/general/2014/12/16/nos-decidimos-por-gae" title="Nos decidimos por GAE">&laquo; Previous</a></li>
    
      <li><a href="/archive.html">Archive</a></li>
    
      <li class="next"><a href="/test/2014/12/16/test-unitarios-para-python" title="Test unitarios para python">Next &raquo;</a></li>
    
    </ul>
    <hr>
    
  </div>
</div>


      </div>

    </div>

    <!--<div id="footer">
      <div class="container">
        <p>&copy; 2014 Evenge
          with help from <a href="http://jekyllbootstrap.com" target="_blank" title="The Definitive Jekyll Blogging Framework">Jekyll Bootstrap</a>
          and <a href="http://twitter.github.com/bootstrap/" target="_blank">Twitter Bootstrap</a>
        </p>
      </div>
    </div> -->

    


    <!-- Latest compiled and minified JavaScript, requires jQuery 1.x (2.x not supported in IE8) -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
    <script src="/assets/themes/bootstrap-3/bootstrap/js/bootstrap.min.js"></script>
  </body>
</html>

